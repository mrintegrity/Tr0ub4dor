<?php  session_start();    require_once("check_refer.php");  require_once("config.php");  require_once("common_func.php");    	if ((isset($_SESSION['logged_in'])) && ($_SESSION['logged_in'] == 1)) {		// session is active				// any actions to perform?		if (isset($_POST['action'])) {			// save new entry			if ($_POST['action'] == "save")	{				if ($conn = mysql_connect(DB_HOST, DB_USER, DB_PASS))	{					if (mysql_select_db(DB_NAME, $conn))	{						$list = mysql_query ("INSERT INTO wallet VALUES('','".              mysql_real_escape_string (en_crypt(htmlentities($_POST['itemname']), $_SESSION['key']))."','".              mysql_real_escape_string (en_crypt(htmlentities($_POST['host']), $_SESSION['key']))."','".              mysql_real_escape_string (en_crypt(htmlentities($_POST['login']), $_SESSION['key']))."','".              mysql_real_escape_string (en_crypt(htmlentities($_POST['password']), $_SESSION['key']))."','".              mysql_real_escape_string (en_crypt(htmlentities($_POST['comment']), $_SESSION['key']))."')");												unset($_POST['itemname'], $_POST['host'], $_POST['login'], $_POST['password'], $_POST['comment']);					}	else {						$sysmsg__ = "<br />Ooops - <b>can't find the database</b>....\n";            show_sys_msg($sysmsg__, $SYSMSG_KEY);					}					mysql_close($conn);				} else {					$sysmsg__ = "<br />Ooops - <b>can't connect to the database-server</b>...\n";          show_sys_msg($sysmsg__, $SYSMSG_KEY);				}			}						// save edited entry			if ($_POST['action'] == "editsave")	{				if ($conn = mysql_connect(DB_HOST, DB_USER, DB_PASS))	{					if (mysql_select_db(DB_NAME,$conn))	{						$list = mysql_query ("UPDATE wallet SET itemname='".mysql_real_escape_string(en_crypt(htmlentities($_POST['itemname']), $_SESSION['key'])).              "', host='".mysql_real_escape_string(en_crypt(htmlentities($_POST['host']), $_SESSION['key'])).              "', login='".mysql_real_escape_string(en_crypt(htmlentities($_POST['login']), $_SESSION['key'])).              "', pw='".mysql_real_escape_string(en_crypt(htmlentities($_POST['password']), $_SESSION['key'])).              "', comment='".mysql_real_escape_string(en_crypt(htmlentities($_POST['comment']), $_SESSION['key'])).              "' WHERE ID=".$_POST['ID']);            unset($_POST['itemname'], $_POST['host'], $_POST['login'], $_POST['password'], $_POST['comment']);            go_to_url("../main.php");            //header("Location:/main.php");					}	else {						$sysmsg__ = "<br />Ooops - <b>can't find the database</b>....\n";            show_sys_msg($sysmsg__, $SYSMSG_KEY);					}					mysql_close($conn);				}	else {					$sysmsg__ = "<br />Ooops - <b>can't connect to the database-server</b>...\n";          show_sys_msg($sysmsg__, $SYSMSG_KEY);				}			}						// delete entry			if ($_POST['action'] == "reallydelete")	{				if ($conn = mysql_connect(DB_HOST, DB_USER, DB_PASS))	{					if (mysql_select_db(DB_NAME,$conn))	{						$list = mysql_query ("DELETE FROM wallet WHERE ID=".$_POST['ID']);					}	else {						$sysmsg__ = "<br />Ooops - <b>can't find the database</b>....\n";            show_sys_msg($sysmsg__, $SYSMSG_KEY);					}					mysql_close($conn);				} else {					$sysmsg__ = "<br />Ooops - <b>can't connect to the database-server</b>...\n";          show_sys_msg($sysmsg__, $SYSMSG_KEY);				}			}						// import uploaded file			if ($_POST['action'] == "import")	{					$row = $_POST['row'];					// check that each header field is used only once in import2.php								// sort header_fields by occurence				asort($row);								if ($conn = mysql_connect(DB_HOST, DB_USER, DB_PASS))	{					if (mysql_select_db(DB_NAME,$conn)) {						// finally import the data												$fd = fopen ($TMP_PATH."w3pw.csv", "r");						while ($data = fgetcsv ($fd, 4096, ";")) {							if (count($data)>1) {								$mysql_string="INSERT INTO wallet VALUES(''";									reset($_POST['row']);								while (list ($index, $val) = each ($_POST['row'])) {									$mysql_string.=",'".mysql_real_escape_string(en_crypt($data[$val],$_SESSION['key']))."'";								}								$mysql_string.=")";								mysql_query ($mysql_string);								unset($mysql_string);							}						}						fclose ($fd);												unset($row);							unset($data);					} else {						$sysmsg__ = "<br />Ooops - <b>can't find the database</b>....\n";            show_sys_msg($sysmsg__, $SYSMSG_KEY);					}					mysql_close($conn);				}	else {					$sysmsg__ = "<br />Ooops - <b>can't connect to the database-server</b>...\n";          show_sys_msg($sysmsg__, $SYSMSG_KEY);				}			}      //Forward after success      go_to_url("../main.php");      //header("Location:/main.php");		}  }?>